<div>
    <ng-include onload="ctrl.onload()" src="'/views/requestform.html'"></ng-include>
    
    <div class="requestform">
	<div class="formfield">
            <label for="tags">Tags: </label>
            <tags-input id="tags" ng-model="cr.tags"
			allowed-tags-pattern="^[a-zA-Z0-9\-\.\s]+$">
		<auto-complete id="autocomplete" source="getTags($query)" min-length="1"></auto-complete>
	    </tags-input>
	</div>
    </div>
    <textarea id="comment" ng-show="showComment" ng-model="cr.comment"></textarea>

    <div class="formButtons">
        <button ng-click="ctrl.update(cr)">Publish</button>
        <button ng-click="ctrl.sendDraft(cr)">Save as Draft</button>
        <button ng-click="ctrl.approve(cr)" ng-show="cr.status == 'created'">Approve</button>
        <button ng-click="ctrl.succeeded(cr,true)" ng-show="cr.status =='approved'">Success</button>
        <button ng-click="ctrl.succeeded(cr,false)" ng-show="cr.status =='approved'">Failure</button>
    </div>
    <button id="audit_trail_button" class="btn btn-default" ng-init="isCollapsed = true" ng-click="isCollapsed = !isCollapsed">Audit Trail</button>
    <div class="audit_trail" collapse="isCollapsed">
        <div class="panel panel-default" ng-repeat="audit_entry in cr.audit_trail">
            <div class="panel-heading">
                On {{audit_entry.date | datetime}} <strong>{{audit_entry.user}}</strong> edited this request:
            </div>
            <div class="panel-body audit_entry">
                <ul class="audit_changes">
                    <li class="audit_change" ng-repeat="change in audit_entry.changes">
                        Changed {{change.property}} from "{{change.from}}" to "{{change.to}}"
                    </li>
                </ul>
                <div class="well audit_comment" ng-show="audit_entry.comment">
                    {{audit_entry.comment}}
                </div>
            </div>
        </div>
    </div>
</div>
